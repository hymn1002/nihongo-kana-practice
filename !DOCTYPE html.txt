<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­äº”åéŸ³å›¾è‡ªåŠ©å¬å†™ç»ƒä¹ </title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 20px;
            position: relative;
        }
        h1 {
            font-size: 2.4rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }
        /* æ¨¡å¼åˆ‡æ¢æ ï¼ˆå³ä¸Šè§’ï¼‰ */
        .mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .mode-btn-toggle {
            padding: 8px 16px;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #ecf0f1;
            color: #2c3e50;
            transition: all 0.2s;
        }
        .mode-btn-toggle.active {
            background: #3498db;
            color: white;
        }
        .mode-btn-toggle:hover:not(.active) {
            background: #d6dbdf;
        }
        .mode-selector {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            margin-bottom: 30px;
            text-align: center;
        }
        .mode-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .mode-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .mode-btn {
            padding: 14px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #3498db;
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
            background: #2980b9;
        }
        .mode-btn:active {
            transform: translateY(0);
        }
        .mode-btn:nth-child(2) {
            background: #2ecc71;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }
        .mode-btn:nth-child(2):hover {
            background: #27ae60;
            box-shadow: 0 6px 16px rgba(46, 204, 113, 0.4);
        }
        .quiz-section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            margin-bottom: 30px;
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f2f6;
        }
        .progress {
            font-size: 1.1rem;
            font-weight: 600;
            color: #3498db;
        }
        .question-container {
            text-align: center;
            margin: 30px 0;
        }
        .question-display {
            font-size: 5rem;
            font-weight: bold;
            margin: 30px 0;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .kana {
            font-family: "Hiragino Kaku Gothic Pro", "Meiryo", sans-serif;
        }
        .romaji {
            font-family: "Courier New", monospace;
            font-size: 1.8rem;
            color: #7f8c8d;
        }
        .audio-control {
            margin: 25px 0;
        }
        .play-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #3498db;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            transition: all 0.2s;
        }
        .play-btn:hover {
            transform: scale(1.05);
            background: #2980b9;
        }
        .play-btn:active {
            transform: scale(0.95);
        }
        .input-group {
            margin: 30px 0;
        }
        .input-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        .answer-input {
            width: 100%;
            padding: 16px;
            font-size: 1.4rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            transition: border-color 0.3s;
        }
        .answer-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        .btn {
            padding: 14px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .next-btn {
            background: #3498db;
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        .next-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .result-section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
        }
        .result-title {
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
        }
        .score-display {
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 20px 0;
            color: #27ae60;
        }
        .accuracy-display {
            text-align: center;
            font-size: 1.4rem;
            font-weight: 600;
            margin: 15px 0;
            color: #3498db;
        }
        .answers-list {
            margin-top: 25px;
        }
        .answer-item {
            padding: 15px;
            margin: 12px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .answer-header {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .answer-content {
            display: flex;
            justify-content: space-between;
            font-family: "Courier New", monospace;
        }
        .correct {
            color: #27ae60;
        }
        .incorrect {
            color: #e74c3c;
        }
        .feedback {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }
        .restart-btn {
            display: block;
            width: 200px;
            margin: 25px auto 0;
            padding: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .restart-btn:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        @media (max-width: 600px) {
            .question-display {
                font-size: 4rem;
                height: 120px;
            }
            .mode-buttons {
                flex-direction: column;
                align-items: center;
            }
            .btn {
                width: 100%;
                max-width: 300px;
            }
            .mode-toggle {
                position: static;
                margin-top: 15px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‡¯ğŸ‡µ æ—¥è¯­äº”åéŸ³å›¾è‡ªåŠ©å¬å†™ç»ƒä¹ </h1>
            <p class="subtitle">æ”¯æŒå¹³å‡åã€ç‰‡å‡åã€æµŠéŸ³ï¼ˆãŒãƒ»ã–ãƒ»ã ãƒ»ã°ï¼‰ã€åŠæµŠéŸ³ï¼ˆã±ï¼‰â€”â€”å…± 50+ éŸ³èŠ‚</p>
            <!-- å³ä¸Šè§’æ¨¡å¼åˆ‡æ¢ -->
            <div class="mode-toggle">
                <button id="hiraganaModeBtn" class="mode-btn-toggle active">å¹³å‡åæ¨¡å¼</button>
                <button id="allModeBtn" class="mode-btn-toggle">å…¨éƒ¨æ¨¡å¼</button>
            </div>
        </header>

        <!-- æ¨¡å¼é€‰æ‹© -->
        <section class="mode-selector">
            <h2 class="mode-title">è¯·é€‰æ‹©ç»ƒä¹ æ¨¡å¼</h2>
            <div class="mode-buttons">
                <button id="listenModeBtn" class="mode-btn">ğŸ§ å¬éŸ³å†™å‡åï¼ˆè‡ªè¯„æ ¸å¯¹ï¼‰</button>
                <button id="writeModeBtn" class="mode-btn">âœï¸ çœ‹å‡åå†™ç½—é©¬éŸ³ï¼ˆè‡ªåŠ¨è¯„åˆ†ï¼‰</button>
            </div>
        </section>

        <!-- å¬éŸ³æ¨¡å¼æµ‹éªŒåŒº -->
        <section id="listenQuiz" class="quiz-section">
            <div class="quiz-header">
                <h2>ğŸ§ å¬éŸ³å†™å‡åç»ƒä¹ </h2>
                <div class="progress">ç¬¬ <span id="listenCurrent">1</span>/5 é¢˜</div>
            </div>
            <div class="question-container">
                <div class="question-display kana" id="listenKanaDisplay">â€”</div>
                <div class="audio-control">
                    <button id="listenPlayBtn" class="play-btn">â–¶</button>
                </div>
                <p>è¯·åœ¨çº¸ä¸Šå†™å‡ºå¬åˆ°çš„å‡åï¼Œå®Œæˆåç‚¹å‡»â€œä¸‹ä¸€é¢˜â€</p>
            </div>
            <div class="action-buttons">
                <button id="listenNextBtn" class="btn next-btn">â¡ ä¸‹ä¸€é¢˜</button>
            </div>
        </section>

        <!-- å†™éŸ³æ¨¡å¼æµ‹éªŒåŒºï¼ˆæ— æäº¤æŒ‰é’®ï¼Œä»…è¾“å…¥+ä¸‹ä¸€é¢˜ï¼‰ -->
        <section id="writeQuiz" class="quiz-section">
            <div class="quiz-header">
                <h2>âœï¸ çœ‹å‡åå†™ç½—é©¬éŸ³ç»ƒä¹ </h2>
                <div class="progress">ç¬¬ <span id="writeCurrent">1</span>/5 é¢˜</div>
            </div>
            <div class="question-container">
                <div class="question-display kana" id="writeKanaDisplay">ã‹</div>
                <div class="input-group">
                    <label class="input-label" for="writeAnswerInput">è¯·è¾“å…¥å¯¹åº”çš„ç½—é©¬éŸ³ï¼ˆå¦‚ï¼škaï¼‰ï¼š</label>
                    <input type="text" id="writeAnswerInput" class="answer-input" placeholder="ä¾‹å¦‚ï¼ška">
                </div>
            </div>
            <div class="action-buttons">
                <button id="writeNextBtn" class="btn next-btn">â¡ ä¸‹ä¸€é¢˜</button>
            </div>
        </section>

        <!-- ç»“æœé¡µ -->
        <section id="resultSection" class="result-section">
            <h2 class="result-title">ğŸ“ ç»ƒä¹ å®Œæˆï¼</h2>
            <div id="scoreDisplay" class="score-display">å¾—åˆ†ï¼šâ€” / 5</div>
            <div id="accuracyDisplay" class="accuracy-display">æ­£ç¡®ç‡ï¼šâ€”%</div>
            <div class="answers-list" id="answersList">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div id="feedback" class="feedback"></div>
            <button id="restartBtn" class="restart-btn">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </section>
    </div>

    <script>
        // åŸå§‹å®Œæ•´æ•°æ®ï¼ˆå«å¹³å‡åã€ç‰‡å‡åã€ç½—é©¬éŸ³ï¼‰
        const kanaData = [
            // æ¸…éŸ³
            { hira: 'ã‚', kata: 'ã‚¢', romaji: 'a' },
            { hira: 'ã„', kata: 'ã‚¤', romaji: 'i' },
            { hira: 'ã†', kata: 'ã‚¦', romaji: 'u' },
            { hira: 'ãˆ', kata: 'ã‚¨', romaji: 'e' },
            { hira: 'ãŠ', kata: 'ã‚ª', romaji: 'o' },
            
            { hira: 'ã‹', kata: 'ã‚«', romaji: 'ka' },
            { hira: 'ã', kata: 'ã‚­', romaji: 'ki' },
            { hira: 'ã', kata: 'ã‚¯', romaji: 'ku' },
            { hira: 'ã‘', kata: 'ã‚±', romaji: 'ke' },
            { hira: 'ã“', kata: 'ã‚³', romaji: 'ko' },

            { hira: 'ã•', kata: 'ã‚µ', romaji: 'sa' },
            { hira: 'ã—', kata: 'ã‚·', romaji: 'shi' },
            { hira: 'ã™', kata: 'ã‚¹', romaji: 'su' },
            { hira: 'ã›', kata: 'ã‚»', romaji: 'se' },
            { hira: 'ã', kata: 'ã‚½', romaji: 'so' },

            { hira: 'ãŸ', kata: 'ã‚¿', romaji: 'ta' },
            { hira: 'ã¡', kata: 'ãƒ', romaji: 'chi' },
            { hira: 'ã¤', kata: 'ãƒ„', romaji: 'tsu' },
            { hira: 'ã¦', kata: 'ãƒ†', romaji: 'te' },
            { hira: 'ã¨', kata: 'ãƒˆ', romaji: 'to' },

            { hira: 'ãª', kata: 'ãƒŠ', romaji: 'na' },
            { hira: 'ã«', kata: 'ãƒ‹', romaji: 'ni' },
            { hira: 'ã¬', kata: 'ãƒŒ', romaji: 'nu' },
            { hira: 'ã­', kata: 'ãƒ', romaji: 'ne' },
            { hira: 'ã®', kata: 'ãƒ', romaji: 'no' },

            { hira: 'ã¯', kata: 'ãƒ', romaji: 'ha' },
            { hira: 'ã²', kata: 'ãƒ’', romaji: 'hi' },
            { hira: 'ãµ', kata: 'ãƒ•', romaji: 'fu' },
            { hira: 'ã¸', kata: 'ãƒ˜', romaji: 'he' },
            { hira: 'ã»', kata: 'ãƒ›', romaji: 'ho' },

            { hira: 'ã¾', kata: 'ãƒ', romaji: 'ma' },
            { hira: 'ã¿', kata: 'ãƒŸ', romaji: 'mi' },
            { hira: 'ã‚€', kata: 'ãƒ ', romaji: 'mu' },
            { hira: 'ã‚', kata: 'ãƒ¡', romaji: 'me' },
            { hira: 'ã‚‚', kata: 'ãƒ¢', romaji: 'mo' },

            { hira: 'ã‚„', kata: 'ãƒ¤', romaji: 'ya' },
            { hira: 'ã‚†', kata: 'ãƒ¦', romaji: 'yu' },
            { hira: 'ã‚ˆ', kata: 'ãƒ¨', romaji: 'yo' },

            { hira: 'ã‚‰', kata: 'ãƒ©', romaji: 'ra' },
            { hira: 'ã‚Š', kata: 'ãƒª', romaji: 'ri' },
            { hira: 'ã‚‹', kata: 'ãƒ«', romaji: 'ru' },
            { hira: 'ã‚Œ', kata: 'ãƒ¬', romaji: 're' },
            { hira: 'ã‚', kata: 'ãƒ­', romaji: 'ro' },

            { hira: 'ã‚', kata: 'ãƒ¯', romaji: 'wa' },
            { hira: 'ã‚’', kata: 'ãƒ²', romaji: 'wo' },
            { hira: 'ã‚“', kata: 'ãƒ³', romaji: 'n' },

            // æµŠéŸ³
            { hira: 'ãŒ', kata: 'ã‚¬', romaji: 'ga' },
            { hira: 'ã', kata: 'ã‚®', romaji: 'gi' },
            { hira: 'ã', kata: 'ã‚°', romaji: 'gu' },
            { hira: 'ã’', kata: 'ã‚²', romaji: 'ge' },
            { hira: 'ã”', kata: 'ã‚´', romaji: 'go' },

            { hira: 'ã–', kata: 'ã‚¶', romaji: 'za' },
            { hira: 'ã˜', kata: 'ã‚¸', romaji: 'ji' },
            { hira: 'ãš', kata: 'ã‚º', romaji: 'zu' },
            { hira: 'ãœ', kata: 'ã‚¼', romaji: 'ze' },
            { hira: 'ã', kata: 'ã‚¾', romaji: 'zo' },

            { hira: 'ã ', kata: 'ãƒ€', romaji: 'da' },
            { hira: 'ã¢', kata: 'ãƒ‚', romaji: 'ji' }, // åŒã˜
            { hira: 'ã¥', kata: 'ãƒ…', romaji: 'zu' }, // åŒãš
            { hira: 'ã§', kata: 'ãƒ‡', romaji: 'de' },
            { hira: 'ã©', kata: 'ãƒ‰', romaji: 'do' },

            { hira: 'ã°', kata: 'ãƒ', romaji: 'ba' },
            { hira: 'ã³', kata: 'ãƒ“', romaji: 'bi' },
            { hira: 'ã¶', kata: 'ãƒ–', romaji: 'bu' },
            { hira: 'ã¹', kata: 'ãƒ™', romaji: 'be' },
            { hira: 'ã¼', kata: 'ãƒœ', romaji: 'bo' },

            // åŠæµŠéŸ³
            { hira: 'ã±', kata: 'ãƒ‘', romaji: 'pa' },
            { hira: 'ã´', kata: 'ãƒ”', romaji: 'pi' },
            { hira: 'ã·', kata: 'ãƒ—', romaji: 'pu' },
            { hira: 'ãº', kata: 'ãƒš', romaji: 'pe' },
            { hira: 'ã½', kata: 'ãƒ', romaji: 'po' },
        ];

        // å½“å‰çŠ¶æ€
        let currentMode = null; // 'listen' or 'write'
        let currentQuestionIndex = 0;
        let quizQuestions = [];
        let userAnswers = [];
        let kanaMode = 'all'; // 'hiragana' or 'all'

        // DOM å…ƒç´ 
        const listenQuiz = document.getElementById('listenQuiz');
        const writeQuiz = document.getElementById('writeQuiz');
        const resultSection = document.getElementById('resultSection');
        const listenKanaDisplay = document.getElementById('listenKanaDisplay');
        const writeKanaDisplay = document.getElementById('writeKanaDisplay');
        const listenCurrent = document.getElementById('listenCurrent');
        const writeCurrent = document.getElementById('writeCurrent');
        const writeAnswerInput = document.getElementById('writeAnswerInput');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const accuracyDisplay = document.getElementById('accuracyDisplay');
        const answersList = document.getElementById('answersList');
        const feedback = document.getElementById('feedback');
        const restartBtn = document.getElementById('restartBtn');

        // æŒ‰é’®å…ƒç´ 
        const listenModeBtn = document.getElementById('listenModeBtn');
        const writeModeBtn = document.getElementById('writeModeBtn');
        const listenPlayBtn = document.getElementById('listenPlayBtn');
        const listenNextBtn = document.getElementById('listenNextBtn');
        const writeNextBtn = document.getElementById('writeNextBtn');
        const hiraganaModeBtn = document.getElementById('hiraganaModeBtn');
        const allModeBtn = document.getElementById('allModeBtn');

        // åˆå§‹åŒ–ï¼šæ ¹æ®å½“å‰ kanaMode è¿‡æ»¤é¢˜ç›®
        function generateQuiz(mode) {
            let candidates = [...kanaData];
            if (kanaMode === 'hiragana') {
                // ä»…ä¿ç•™å¹³å‡åï¼ˆå³æ‰€æœ‰ hira å­—æ®µéç©ºä¸”ä¸ä¸ºå ä½ç¬¦ï¼‰
                candidates = candidates.filter(q => q.hira && q.hira.length > 0);
            }
            const shuffled = candidates.sort(() => Math.random() - 0.5);
            quizQuestions = shuffled.slice(0, 5);
            currentQuestionIndex = 0;
            userAnswers = [];
        }

        // æ˜¾ç¤ºé¢˜ç›®ï¼ˆå¬éŸ³æ¨¡å¼ï¼‰â†’ æ˜¾ç¤ºå ä½ç¬¦ï¼Œä¸æ˜¾ç¤ºå‡å
        function showListenQuestion() {
            listenKanaDisplay.textContent = 'â€”';
            listenCurrent.textContent = currentQuestionIndex + 1;
        }

        // æ˜¾ç¤ºé¢˜ç›®ï¼ˆå†™éŸ³æ¨¡å¼ï¼‰
        function showWriteQuestion() {
            const q = quizQuestions[currentQuestionIndex];
            // å¹³å‡åæ¨¡å¼ä¸‹åªæ˜¾ç¤ºå¹³å‡åï¼›å…¨éƒ¨æ¨¡å¼éšæœºæ˜¾ç¤ºå¹³/ç‰‡
            let displayChar;
            if (kanaMode === 'hiragana') {
                displayChar = q.hira;
            } else {
                displayChar = Math.random() > 0.5 ? q.hira : q.kata;
            }
            writeKanaDisplay.textContent = displayChar;
            writeCurrent.textContent = currentQuestionIndex + 1;
            writeAnswerInput.value = '';
            writeAnswerInput.focus();
        }

        // æ’­æ”¾éŸ³é¢‘æ¨¡æ‹Ÿ
        function playKanaSound() {
            const q = quizQuestions[currentQuestionIndex];
            listenPlayBtn.innerHTML = 'ğŸ”Š';
            setTimeout(() => {
                listenPlayBtn.innerHTML = 'â–¶';
            }, 800);
        }

        // æ”¶é›†ç”¨æˆ·ç­”æ¡ˆï¼ˆåœ¨â€œä¸‹ä¸€é¢˜â€æ—¶ä¿å­˜å½“å‰è¾“å…¥ï¼‰
        function saveCurrentAnswer() {
            if (currentMode === 'write') {
                const userAns = writeAnswerInput.value.trim();
                userAnswers.push(userAns);
            }
        }

        // æ˜¾ç¤ºç»“æœé¡µï¼ˆç»Ÿä¸€åœ¨å…¨éƒ¨5é¢˜å®Œæˆåè°ƒç”¨ï¼‰
        function showResults() {
            // è®¡ç®—å¾—åˆ†ä¸æ­£ç¡®ç‡
            let correctCount = 0;
            const total = 5;
            const results = [];
            
            quizQuestions.forEach((q, i) => {
                const userAns = userAnswers[i] || '';
                const correctAns = q.romaji.toLowerCase();
                const isCorrect = userAns.toLowerCase() === correctAns;
                if (isCorrect) correctCount++;
                
                results.push({
                    hira: q.hira,
                    kata: q.kata,
                    user: userAns,
                    correct: correctAns,
                    isCorrect
                });
            });

            const score = correctCount;
            const accuracy = Math.round((correctCount / total) * 100);

            scoreDisplay.textContent = `å¾—åˆ†ï¼š${score} / ${total}`;
            accuracyDisplay.textContent = `æ­£ç¡®ç‡ï¼š${accuracy}%`;
            
            // ç”Ÿæˆç­”æ¡ˆå¯¹ç…§è¡¨
            answersList.innerHTML = '';
            results.forEach((r, i) => {
                const li = document.createElement('div');
                li.className = 'answer-item';
                li.innerHTML = `
                    <div class="answer-header">ç¬¬ ${i + 1} é¢˜ï¼š${r.hira} / ${r.kata}</div>
                    <div class="answer-content">
                        <span>ä½ çš„ç­”æ¡ˆï¼š<span class="${r.isCorrect ? 'correct' : 'incorrect'}">${r.user || 'ï¼ˆæœªä½œç­”ï¼‰'}</span></span>
                        <span>æ­£ç¡®ç­”æ¡ˆï¼š${r.correct}</span>
                    </div>
                `;
                answersList.appendChild(li);
            });

            // ğŸ· çŒªç³»åé¦ˆï¼ˆæŒ‰æ­£ç¡®ç‡ï¼‰
            let feedbackText = '';
            if (score === 5) {
                feedbackText = 'ğŸ· ä½ çœŸæ˜¯ä¸€å¤´èªæ˜çš„å°çŒª';
                feedback.style.background = '#d4edda';
                feedback.style.color = '#155724';
            } else if (score === 4) {
                feedbackText = 'ğŸ· çŒªç”Ÿä»éœ€åŠªåŠ›';
                feedback.style.background = '#d1ecf1';
                feedback.style.color = '#0c5460';
            } else {
                feedbackText = 'ğŸ· ä½ è¿™å¤´çŒªï¼ç¬¨ï¼';
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#721c24';
            }

            feedback.textContent = feedbackText;

            // åˆ‡æ¢è§†å›¾
            listenQuiz.style.display = 'none';
            writeQuiz.style.display = 'none';
            resultSection.style.display = 'block';
        }

        // å¼€å§‹æµ‹éªŒ
        function startQuiz(mode) {
            currentMode = mode;
            generateQuiz(mode);
            
            if (mode === 'listen') {
                listenQuiz.style.display = 'block';
                writeQuiz.style.display = 'none';
                resultSection.style.display = 'none';
                showListenQuestion();
            } else {
                writeQuiz.style.display = 'block';
                listenQuiz.style.display = 'none';
                resultSection.style.display = 'none';
                showWriteQuestion();
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        listenModeBtn.addEventListener('click', () => startQuiz('listen'));
        writeModeBtn.addEventListener('click', () => startQuiz('write'));

        listenPlayBtn.addEventListener('click', playKanaSound);
        
        listenNextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < 4) {
                currentQuestionIndex++;
                showListenQuestion();
            } else {
                // å¬éŸ³æ¨¡å¼ï¼šæ˜¾ç¤ºæ‰€æœ‰5é¢˜çš„æ­£ç¡®ç­”æ¡ˆä¾›æ ¸å¯¹ï¼ˆæ— è¯„åˆ†ï¼‰
                resultSection.style.display = 'block';
                listenQuiz.style.display = 'none';
                writeQuiz.style.display = 'none';

                scoreDisplay.textContent = 'å¬éŸ³ç»ƒä¹ å®Œæˆ â€”â€” è¯·è‡ªè¡Œæ ¸å¯¹ç­”æ¡ˆ';
                accuracyDisplay.textContent = '';
                answersList.innerHTML = '';
                quizQuestions.forEach((q, i) => {
                    const li = document.createElement('div');
                    li.className = 'answer-item';
                    li.innerHTML = `
                        <div class="answer-header">ç¬¬ ${i + 1} é¢˜</div>
                        <div class="answer-content">
                            <span>å‡åï¼š<span class="correct">${q.hira} / ${q.kata}</span></span>
                            <span>ç½—é©¬éŸ³ï¼š${q.romaji}</span>
                        </div>
                    `;
                    answersList.appendChild(li);
                });
                feedback.textContent = 'âœ… ç»§ç»­åšæŒç»ƒä¹ ï¼Œå¬åŠ›ä¼šè¶Šæ¥è¶Šæ•é”ï¼';
                feedback.style.background = '#d1ecf1';
                feedback.style.color = '#0c5460';
            }
        });

        writeNextBtn.addEventListener('click', () => {
            // âœ… æ¯æ¬¡ç‚¹å‡»â€œä¸‹ä¸€é¢˜â€æ—¶ï¼Œå…ˆä¿å­˜å½“å‰ç­”æ¡ˆ
            saveCurrentAnswer();

            if (currentQuestionIndex < 4) {
                currentQuestionIndex++;
                showWriteQuestion();
            } else {
                // âœ… å…¨éƒ¨5é¢˜å®Œæˆåï¼Œç»Ÿä¸€æ˜¾ç¤ºè¯„åˆ†ä¸å¯¹ç…§è¡¨
                showResults();
            }
        });

        restartBtn.addEventListener('click', () => {
            resultSection.style.display = 'none';
            // å›åˆ°æ¨¡å¼é€‰æ‹©é¡µ
            listenQuiz.style.display = 'none';
            writeQuiz.style.display = 'none';
        });

        // é”®ç›˜æ”¯æŒï¼šEnter è§¦å‘â€œä¸‹ä¸€é¢˜â€
        writeAnswerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                writeNextBtn.click();
            }
        });

        // å¹³å‡å/å…¨éƒ¨æ¨¡å¼åˆ‡æ¢
        hiraganaModeBtn.addEventListener('click', () => {
            kanaMode = 'hiragana';
            hiraganaModeBtn.classList.add('active');
            allModeBtn.classList.remove('active');
        });

        allModeBtn.addEventListener('click', () => {
            kanaMode = 'all';
            allModeBtn.classList.add('active');
            hiraganaModeBtn.classList.remove('active');
        });

        // é¡µé¢åŠ è½½åé»˜è®¤èšç„¦ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼ˆæ— éšœç¢å‹å¥½ï¼‰
        document.addEventListener('DOMContentLoaded', () => {
            listenModeBtn.focus();
        });
    </script>
</body>
</html>
